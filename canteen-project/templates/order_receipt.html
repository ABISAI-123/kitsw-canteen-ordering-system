{% extends "base_new.html" %}
{% block title %}Order Receipt{% endblock %}
{% block content %}
<div class="card mx-auto" style="max-width:600px;">
  <div class="card-body">
    <h4>Order #{{ order.id }} - {{ order.item_name }}</h4>
    <p><b>Token:</b> {{ order.token }}</p>
    <p><b>Pickup:</b> {{ order.pickup_time }}</p>
    <p><b>Status:</b> {{ order.status }}</p>
    <p><b>Payment Status:</b> {{ order.payment_status }}</p>
    <p><b>Placed at:</b> {{ order.created_at }}</p>
    <a class="btn btn-primary" href="{{ url_for('menu') }}">Back to Menu</a>
  </div>
</div>

<script>
  // Poll for status updates for this order
  const oid = {{ order.id }};
  setInterval(async () => {
    const res = await fetch('/api/orders');
    const data = await res.json();
    const thisOrder = data.find(o => o.id === oid);
    if (thisOrder && thisOrder.status !== "{{ order.status }}") {
      location.reload();
    }
  }, 5000);
</script>
{% endblock %}
